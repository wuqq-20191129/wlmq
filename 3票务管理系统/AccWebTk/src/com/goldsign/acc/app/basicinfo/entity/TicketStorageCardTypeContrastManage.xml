<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goldsign.acc.app.basicinfo.mapper.TicketStorageCardTypeContrastManageMapper">
    <resultMap type="TicketStorageCardTypeContrastManage" id="rmTicketStorageCardTypeContrastManage">
        
        <result column="ic_main_type" property="ic_main_type" /> 
        <result column="ic_main_desc" property="ic_main_desc" />
        <result column="ic_sub_type" property="ic_sub_type" /> 
        <result column="ic_sub_desc" property="ic_sub_desc" />
        <result column="card_main_type" property="card_main_type" /> 
        <result column="card_main_name" property="card_main_name" />
        <result column="card_sub_type" property="card_sub_type" /> 
        <result column="card_sub_name" property="card_sub_name" />
        <result column="box_unit" property="box_unit" />
        <result column="base_flag" property="base_flag" />
    </resultMap>
     
    <select id="getTicketStorageCardTypeContrastManage"  parameterType="TicketStorageCardTypeContrastManage" resultMap="rmTicketStorageCardTypeContrastManage">
        select a.ic_main_type,a.ic_sub_type,a.card_main_type,a.card_sub_type,a.box_unit,a.base_flag
        from  W_ACC_TK.W_IC_COD_CARD_TYPE_CONTRAST a,W_ACC_TK.W_IC_COD_CARD_SUB_TYPE b,W_ACC_ST.W_OP_PRM_CARD_SUB c 
        where a.ic_main_type=b.ic_main_type and a.ic_sub_type=b.ic_sub_type and a.card_main_type=c.card_main_id 
        and a.card_sub_type=c.card_sub_id and c.record_flag='0'
        <if test="ic_main_type !=null and ic_main_type !=''">
            and a.ic_main_type =#{ic_main_type} 
        </if>
        <if test="ic_sub_type !=null and ic_sub_type !=''">
            and a.ic_sub_type =#{ic_sub_type} 
        </if>
        <if test="base_flag !=null and base_flag !=''">
            and base_flag =#{base_flag} 
        </if>
        order by to_number(ic_main_type),to_number(ic_sub_type)
    </select>
    
    <select id="getTicketStorageCardTypeContrastManageById"  parameterType="TicketStorageCardTypeContrastManage" resultMap="rmTicketStorageCardTypeContrastManage">
        select * from  W_ACC_TK.W_IC_COD_CARD_TYPE_CONTRAST where ic_main_type =#{ic_main_type} and ic_sub_type =#{ic_sub_type}  
    </select>
    
    <select id="getTicketStorageCardTypeContrastManageByFlag"  parameterType="TicketStorageCardTypeContrastManage" resultMap="rmTicketStorageCardTypeContrastManage">
        select * from  W_ACC_TK.W_IC_COD_CARD_TYPE_CONTRAST where card_main_type =#{card_main_type} and card_sub_type =#{card_sub_type} and base_flag ='1' 
    </select>
    
    <select id="getTicketStorageCardTypeContrastManageByStock"  parameterType="TicketStorageCardTypeContrastManage" resultMap="rmTicketStorageCardTypeContrastManage">
        select ic_main_type,ic_sub_type  from  W_ACC_TK.W_IC_STS_AREA_CARD  where card_num>0  and  ic_main_type=#{ic_main_type}  and  ic_sub_type=#{ic_sub_type} 
    </select>
    
    <select id="getTicketStorageCardTypeContrastManageByChect"  parameterType="TicketStorageCardTypeContrastManage" resultMap="rmTicketStorageCardTypeContrastManage">
        select im.ic_main_type,su.ic_sub_type
        from w_acc_tk.w_ic_cod_storage ck 
            inner join w_acc_tk.w_ic_cod_area pq on ck.storage_id=pq.storage_id 
            inner join w_acc_tk.w_ic_cod_chest pg on pg.storage_id=pq.storage_id and pg.area_id=pq.area_id 
            inner join w_acc_tk.w_ic_cod_card_main_type im on im.ic_main_type=pg.ic_main_type 
            inner join w_acc_tk.w_ic_cod_card_sub_type su on pg.ic_main_type=su.ic_main_type and pg.ic_sub_type=su.ic_sub_type 
            inner join w_acc_tk.w_ic_cod_storey cs on pg.storage_id=cs.storage_id and pg.area_id=cs.area_id and pg.chest_id=cs.chest_id and pg.storey_num=cs.storey_id 
            inner join w_acc_tk.w_ic_cod_base tu on cs.storage_id=tu.storage_id and cs.area_id=tu.area_id and cs.chest_id=tu.chest_id and cs.storey_id=tu.storey_id and cs.base_num=tu.base_id 
        where 1=1 
            and im.ic_main_type=#{ic_main_type}  and  su.ic_sub_type=#{ic_sub_type}
    </select>   
    
    <insert id="addTicketStorageCardTypeContrastManage" parameterType="TicketStorageCardTypeContrastManage" >
        insert into W_ACC_TK.W_IC_COD_CARD_TYPE_CONTRAST(ic_main_type,ic_sub_type,card_main_type,card_sub_type,box_unit,base_flag) values(#{ic_main_type},#{ic_sub_type},#{card_main_type},#{card_sub_type},#{box_unit},#{base_flag} )               
    </insert>
    
    <update id="modifyTicketStorageCardTypeContrastManage" parameterType="TicketStorageCardTypeContrastManage" >
        update W_ACC_TK.W_IC_COD_CARD_TYPE_CONTRAST set box_unit =#{box_unit}  where ic_main_type =#{ic_main_type} and ic_sub_type =#{ic_sub_type}                                                 
    </update>
    
    <delete id="deleteTicketStorageCardTypeContrastManage" parameterType="TicketStorageCardTypeContrastManage">
        delete from W_ACC_TK.W_IC_COD_CARD_TYPE_CONTRAST where ic_sub_type =#{ic_sub_type} and ic_main_type =#{ic_main_type} 
    </delete>     
    
</mapper>

