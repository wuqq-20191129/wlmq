<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goldsign.acc.app.prminfo.mapper.CardMainMapper">
    
    <resultMap type="CardMain" id="rmCardMain">
        
        <result column="card_main_id" property="card_main_id" /> 
        <result column="card_main_name" property="card_main_name" /> 
        <result column="version_no" property="version_no" /> 
        <result column="record_flag" property="record_flag" />  
    </resultMap>

    
     
    <select id="getCardMains"  parameterType="CardMain" resultMap="rmCardMain">
        select * from W_ACC_ST.W_OP_PRM_CARD_MAIN where record_flag=#{record_flag} and version_no=#{version_no}  
        <if test="card_main_id !=null and card_main_id !=''">
            and card_main_id =#{card_main_id} 
        </if> 
        <if test="card_main_name !=null and card_main_name !=''">
            and card_main_name like concat(concat('%',#{card_main_name}),'%')
        </if>
        order by card_main_id
    </select>
    
    <select id="queryToMap"  parameterType="CardMain" resultType="map">
        select * from W_ACC_ST.W_OP_PRM_CARD_MAIN where record_flag=#{record_flag} and version_no=#{version_no}  
        <if test="card_main_id !=null and card_main_id !=''">
            and card_main_id =#{card_main_id} 
        </if> 
        <if test="card_main_name !=null and card_main_name !=''">
            and card_main_name like concat(concat('%',#{card_main_name}),'%')
        </if>
        order by card_main_id
    </select>
   
    <insert id="addCardMain" parameterType="CardMain" >
        insert into W_ACC_ST.W_OP_PRM_CARD_MAIN values(#{card_main_id},#{version_no},#{card_main_name},#{record_flag})         
    </insert>
    
    <select id="getCardMainById"  parameterType="CardMain" resultMap="rmCardMain">
        select * from W_ACC_ST.W_OP_PRM_CARD_MAIN where record_flag=#{record_flag} and version_no=#{version_no} and card_main_id =#{card_main_id} 
    </select>
    
    <select id="getCardMainByName"  parameterType="CardMain" resultMap="rmCardMain">
        select * from W_ACC_ST.W_OP_PRM_CARD_MAIN where record_flag=#{record_flag} and version_no=#{version_no} and card_main_name =#{card_main_name} 
        and card_main_id !=#{card_main_id} 
    </select>
    
    <delete id="deleteCardMain" parameterType="CardMain">
        delete from W_ACC_ST.W_OP_PRM_CARD_MAIN 
        where card_main_id =#{card_main_id} and card_main_name =#{card_main_name} and record_flag=#{record_flag} and version_no=#{version_no}  
    </delete>
    
    <update id="modifyCardMain" parameterType="CardMain" >
        update W_ACC_ST.W_OP_PRM_CARD_MAIN set card_main_id=#{card_main_id},card_main_name=#{card_main_name}
        where  card_main_id =#{card_main_id} and record_flag=#{record_flag} and version_no=#{version_no}                    
        
    </update>
    
    <!--草稿参数删除 -->
    <delete id="deleteCardMainForClone" parameterType="CardMain">
        delete from W_ACC_ST.W_OP_PRM_CARD_MAIN where  record_flag='3' and version_no='0000000000'                                                      
    </delete>
    
    <!--当前参数或未来参数克隆为草稿参数 -->
    <insert id="cloneFromCurOrFurToDraft" parameterType="CardMain" >
        insert into  W_ACC_ST.W_OP_PRM_CARD_MAIN(card_main_id,card_main_name,record_flag,version_no)
        select card_main_id,card_main_name,'3','0000000000'
        from   W_ACC_ST.W_OP_PRM_CARD_MAIN  
        where   record_flag=#{record_flag} and version_no=#{version_no}                                        
    </insert>
    
    <!--当前参数、未来参数作历史标识或删除标识 -->
    
     <update id="submitToOldFlag" parameterType="CardMain" >
        update W_ACC_ST.W_OP_PRM_CARD_MAIN set record_flag=#{record_flag_old}
                    where   record_flag=#{record_flag_new}                                               
    </update>
    
    <!--草稿参数复制为当前或未来参数 -->
    <insert id="submitFromDraftToCurOrFur" parameterType="CardMain" >
        insert into  W_ACC_ST.W_OP_PRM_CARD_MAIN(card_main_id,card_main_name,record_flag,version_no)
        select card_main_id,card_main_name,#{record_flag_new},#{version_no_new}
        from   W_ACC_ST.W_OP_PRM_CARD_MAIN  
        where   record_flag=#{record_flag} and version_no=#{version_no}                                        
    </insert>

    
</mapper>


