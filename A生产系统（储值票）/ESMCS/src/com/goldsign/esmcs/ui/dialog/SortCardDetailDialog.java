/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package com.goldsign.esmcs.ui.dialog;

import com.goldsign.csfrm.util.ExcelExport;
import com.goldsign.csfrm.util.UIUtil;
import com.goldsign.esmcs.vo.AnalyzeVo;
import java.util.ArrayList;
import java.util.List;
import javax.swing.JDialog;
import javax.swing.JTable;
import javax.swing.table.DefaultTableModel;
import org.apache.log4j.Logger;

/**
 *
 * @author lenovo
 */
public class SortCardDetailDialog extends JDialog {

    private static final Logger logger = Logger.getLogger(SortCardDetailDialog.class.getName());
    
    private JTable resultSetTableMain;
    
    /**
     * Creates new form MakeCardDetailPanel
     */
    public SortCardDetailDialog() {
        initComponents();
        genMainResultSetTable(new ArrayList<Object[]>());
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jPanel3 = new javax.swing.JPanel();
        closeBtn = new javax.swing.JButton();
        leadOutBtn = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        titleTxt = new javax.swing.JTextField();
        mainSPn = new javax.swing.JScrollPane();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("制卡明细");
        setBounds(new java.awt.Rectangle(0, 0, 0, 0));
        setMinimumSize(new java.awt.Dimension(800, 600));
        setResizable(false);
        setUndecorated(true);

        jPanel1.setBackground(new java.awt.Color(55, 133, 181));
        jPanel1.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(255, 255, 255), 2, true));

        jPanel3.setBackground(new java.awt.Color(237, 247, 249));
        jPanel3.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel3.setPreferredSize(new java.awt.Dimension(790, 108));
        jPanel3.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        closeBtn.setFont(new java.awt.Font("宋体", 1, 14)); // NOI18N
        closeBtn.setText("关闭");
        closeBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                closeBtnActionPerformed(evt);
            }
        });
        jPanel3.add(closeBtn, new org.netbeans.lib.awtextra.AbsoluteConstraints(410, 10, 90, 35));

        leadOutBtn.setFont(new java.awt.Font("宋体", 1, 14)); // NOI18N
        leadOutBtn.setText("导出");
        leadOutBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                leadOutBtnActionPerformed(evt);
            }
        });
        jPanel3.add(leadOutBtn, new org.netbeans.lib.awtextra.AbsoluteConstraints(260, 10, 90, 35));

        jPanel2.setBackground(new java.awt.Color(255, 255, 255));
        jPanel2.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel2.setForeground(new java.awt.Color(255, 255, 255));

        titleTxt.setBackground(new java.awt.Color(185, 227, 241));
        titleTxt.setEditable(false);
        titleTxt.setFont(new java.awt.Font("宋体", 1, 15)); // NOI18N
        titleTxt.setForeground(new java.awt.Color(94, 55, 16));
        titleTxt.setText("   分拣结果列表");
        titleTxt.setAlignmentX(0.0F);
        titleTxt.setAlignmentY(0.0F);
        titleTxt.setBorder(null);

        mainSPn.setBackground(new java.awt.Color(255, 255, 255));
        mainSPn.setBorder(null);

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(titleTxt, javax.swing.GroupLayout.DEFAULT_SIZE, 776, Short.MAX_VALUE)
            .addComponent(mainSPn)
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addComponent(titleTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(7, 7, 7)
                .addComponent(mainSPn, javax.swing.GroupLayout.DEFAULT_SIZE, 485, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel1Layout.createSequentialGroup()
                    .addContainerGap()
                    .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, 780, Short.MAX_VALUE)
                    .addContainerGap()))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(69, Short.MAX_VALUE))
            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel1Layout.createSequentialGroup()
                    .addContainerGap(536, Short.MAX_VALUE)
                    .addComponent(jPanel3, javax.swing.GroupLayout.PREFERRED_SIZE, 54, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap()))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(0, 0, Short.MAX_VALUE)
                .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(0, 0, Short.MAX_VALUE)
                .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    /**
     * 关闭
     * 
     * @param evt 
     */
    private void closeBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_closeBtnActionPerformed
        this.setVisible(false);
    }//GEN-LAST:event_closeBtnActionPerformed

    /**
     * 导出
     * 
     * @param evt 
     */
    private void leadOutBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_leadOutBtnActionPerformed
        leadOut();
    }//GEN-LAST:event_leadOutBtnActionPerformed

    /**
     * 添加分拣信息
     * 
     * @param analyzeVo 
     */
    public void setSortCardDetail(boolean result, AnalyzeVo analyzeVo){
        
        DefaultTableModel tableModel = (DefaultTableModel)resultSetTableMain.getModel();
        Object[] rowData = getSortCardDetail(result, analyzeVo);
        tableModel.insertRow(0, rowData);
    }
    
    /**
     * 格式化分拣明细
     * 
     * @param analyzeVo
     * @return 
     */
    private Object[] getSortCardDetail(boolean result, AnalyzeVo analyzeVo){
    
        Object[] rowData = new Object[23];
        rowData[0] = result?"合法":"非法";
        rowData[1] = analyzeVo.getbIssueStatus().trim();
        rowData[2] = analyzeVo.getbStatus().trim();
        rowData[3] = analyzeVo.getcTicketType().trim();
        rowData[4] = analyzeVo.getcLogicalID().trim();
        rowData[5] = analyzeVo.getcPhysicalID().trim();
        rowData[6] = analyzeVo.getbCharacter().trim();
        rowData[7] = analyzeVo.getcIssueDate().trim();
        rowData[8] = analyzeVo.getcEndExpire().trim();
        rowData[9] = analyzeVo.getTradeCount()+"";
        rowData[10] = analyzeVo.getlBalance()+"";
        rowData[11] = analyzeVo.getlDeposite()+"";
        rowData[12] = analyzeVo.getcLine().trim();
        rowData[13] = analyzeVo.getcStationNo().trim();
        rowData[14] = analyzeVo.getcDateStart().trim();
        rowData[15] = analyzeVo.getcDateEnd().trim();
        rowData[16] = analyzeVo.getDtDaliyActive().trim();
        rowData[17] = analyzeVo.getbEffectDay().trim();
        rowData[18] = analyzeVo.getcLimitEntryLine().trim();
        rowData[19] = analyzeVo.getcLimitEntryStation().trim();
        rowData[20] = analyzeVo.getcLimitExitLine().trim();
        rowData[21] = analyzeVo.getcLimitExitStation().trim();
        rowData[22] = analyzeVo.getcLimitMode().trim();
        
        return rowData;
    }
    
    /**
     * 导出
     * 
     */
    private void leadOut(){
        
        if(null == resultSetTableMain){
            return;
        }
        JTable[] tables = new JTable[]{resultSetTableMain};
        ExcelExport.exportXLSJTable(tables, this);
    }

    /**
     * 根据结果集，生成列表
     *
     * @param result
     */
    private void genMainResultSetTable(List<Object[]> result) {
        
        //列名称
        String[] columnNames = {"结果", "发行状态", "票卡状态", "票卡类型", "逻辑卡号", "物理卡号", 
            "物理类型", "制票日期", "物理有效期", "交易计数", "余额（分）", "押金", "线路", 
            "站点", "有效期开始时间", "有效期结束时间", "逻辑有效期", "多日票有效天数", "限制进站线路",
            "限制进站站点", "限制出站线路", "限制出站站点", "限制模式"};
        //列宽度
        int[] columnSize = {70, 80, 80, 100, 120, 120,
            80, 120, 120, 80, 80, 80, 80,
            80, 120, 120, 120, 80, 80,
            80, 80, 80, 80};
        //生成列表
        resultSetTableMain = UIUtil.genResultSetTable(mainSPn, result, columnNames, columnSize, false);
        resultSetTableMain.setName(titleTxt.getText().trim());
        
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton closeBtn;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JButton leadOutBtn;
    private javax.swing.JScrollPane mainSPn;
    private javax.swing.JTextField titleTxt;
    // End of variables declaration//GEN-END:variables
}
