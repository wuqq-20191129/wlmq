<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goldsign.acc.app.prminfo.mapper.AgentRateMapper">
    <resultMap type="AgentRate" id="rmAgentRate">
        
        <result column="agent_id" property="agent_id" /> 
        <result column="service_rate" property="service_rate" /> 
        <result column="record_flag" property="record_flag" /> 
        <result column="version_no" property="version_no" />
        
    </resultMap>

    
     
    <select id="getAgentRate"  parameterType="AgentRate" resultMap="rmAgentRate">
        select agent_id,version_no,service_rate,record_flag from w_acc_st.w_op_prm_agent_rate  
        where record_flag=#{record_flag} and version_no=#{version_no}   
        order by agent_id
    </select>
    <select id="getAgentRateById"  parameterType="AgentRate" resultMap="rmAgentRate">
        select agent_id,version_no,service_rate,record_flag
        from w_acc_st.w_op_prm_agent_rate where record_flag=#{record_flag} and version_no=#{version_no}
        <if test="agent_id != null and agent_id!=''">
             and agent_id =#{agent_id}
        </if>  
       
        
    </select>
    
    <insert id="addAgentRate" parameterType="AgentRate" >
        insert into w_acc_st.w_op_prm_agent_rate(agent_id,version_no,service_rate,record_flag)
        values(#{agent_id},#{version_no},#{service_rate},#{record_flag})        
        
    </insert>
    
    <update id="modifyAgentRate" parameterType="AgentRate" >

        update w_acc_st.w_op_prm_agent_rate set service_rate=#{service_rate}
        where  agent_id=#{agent_id} and record_flag=#{record_flag} and version_no=#{version_no}                                                   
    </update>
    
    <delete id="deleteAgentRate" parameterType="AgentRate">
        delete from w_acc_st.w_op_prm_agent_rate 
        where  agent_id=#{agent_id} and version_no=#{version_no}           
    </delete>
    <!--草稿参数删除 -->
    <delete id="deleteAgentRateForClone" parameterType="AgentRate">
        delete from W_ACC_ST.W_OP_PRM_AGENT_RATE where  record_flag='3' and version_no='0000000000'                                                      
    </delete>
    
    <!--当前参数或未来参数克隆为草稿参数 -->
    <insert id="cloneFromCurOrFurToDraft" parameterType="AgentRate" >
        insert into  W_ACC_ST.W_OP_PRM_AGENT_RATE(agent_id,service_rate,record_flag,version_no)
        select agent_id,service_rate,'3','0000000000'
        from   W_ACC_ST.W_OP_PRM_AGENT_RATE  
        where   record_flag=#{record_flag} and version_no=#{version_no}                                        
    </insert>
    
    <!--当前参数、未来参数作历史标识或删除标识 -->
    
     <update id="submitToOldFlag" parameterType="AgentRate" >
        update W_ACC_ST.W_OP_PRM_AGENT_RATE set record_flag=#{record_flag_old}
                    where   record_flag=#{record_flag_new}                                               
    </update>
    
    <!--草稿参数复制为当前或未来参数 -->
    <insert id="submitFromDraftToCurOrFur" parameterType="AgentRate" >
        insert into  W_ACC_ST.W_OP_PRM_AGENT_RATE(agent_id,service_rate,record_flag,version_no)
        select agent_id,service_rate,#{record_flag_new},#{version_no_new}
        from   W_ACC_ST.W_OP_PRM_AGENT_RATE  
        where   record_flag=#{record_flag} and version_no=#{version_no}                                        
    </insert>
</mapper>
