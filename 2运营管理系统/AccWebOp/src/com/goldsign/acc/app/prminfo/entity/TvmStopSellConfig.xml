<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.goldsign.acc.app.prminfo.mapper.TvmStopSellConfigMapper">
    <resultMap type="TvmStopSellConfig" id="rmTvmStopSellConfig">
        <result column="flow_id" property="flow_id" />
        <result column="version_no" property="version_no" /> 
        <result column="record_flag" property="record_flag" /> 
        <result column="timeTable_id" property="timeTable_id" /> 
        <result column="begin_date" property="begin_date" /> 
        <result column="end_date" property="end_date" /> 
        <result column="param_type_id" property="param_type_id" /> 
    </resultMap>

    <select id="getTvmStopSellConfigs"  parameterType="TvmStopSellConfig" resultMap="rmTvmStopSellConfig">
        select flow_id,version_no,record_flag,timeTable_id,begin_date,end_date,param_type_id 
        from W_ACC_ST.W_OP_PRM_TVM_STOPSELL_CONFIG where record_flag=#{record_flag} and version_no=#{version_no}
        <if test="begin_date !=null and begin_date !=''">
            and begin_date &gt;= #{begin_date} 
        </if> 
        <if test="end_date !=null and end_date !=''">
            and end_date &lt;=  #{end_date} 
        </if>
        <if test="timeTable_id !=null and timeTable_id !=''">
            and timetable_id =#{timeTable_id}
        </if>
        order by timeTable_id,begin_date,end_date
    </select>
    
    <select id="getTvmStopSellConfigById"  parameterType="TvmStopSellConfig" resultMap="rmTvmStopSellConfig">
        select flow_id,version_no,record_flag,timeTable_id,begin_date,end_date,param_type_id 
        from W_ACC_ST.W_OP_PRM_TVM_STOPSELL_CONFIG 
        where record_flag=#{record_flag} and version_no=#{version_no}  
        <if test="begin_date !=null and begin_date !=''and end_date !=null and end_date !=''">
            and ((begin_date = #{begin_date} and end_date =  #{end_date}) 
            or not(begin_date &gt; #{end_date} or end_date &lt; #{begin_date})) 
        </if> 
        order by timeTable_id,begin_date,end_date
    </select>
    
    <insert id="addTvmStopSellConfig" parameterType="TvmStopSellConfig" >
        insert into W_ACC_ST.W_OP_PRM_TVM_STOPSELL_CONFIG 
                    (flow_id,version_no,record_flag,timeTable_id,begin_date,end_date,param_type_id)
            values  (W_ACC_ST.W_SEQ_W_OP_PRM_TVM_STOPSELL_CF.nextval,#{version_no},#{record_flag},
                     #{timeTable_id},#{begin_date},#{end_date},#{param_type_id})
    </insert>
    
    <update id="modifyTvmStopSellConfig" parameterType="TvmStopSellConfig" >
       update  W_ACC_ST.W_OP_PRM_TVM_STOPSELL_CONFIG 
          set  begin_date=#{begin_date},end_date=#{end_date}
        where  flow_id = #{flow_id}
    </update>
    
    <delete id="deleteTvmStopSellConfig" parameterType="TvmStopSellConfig">
            delete from W_ACC_ST.W_OP_PRM_TVM_STOPSELL_CONFIG 
                where record_flag=#{record_flag} and version_no=#{version_no} and timeTable_id =#{timeTable_id} 
                    and begin_date = #{begin_date} and end_date =  #{end_date}
    </delete>
    
    
    <!--当前参数、未来参数作历史标识或删除标识 -->
    <update id="submitToOldFlag" parameterType="TvmStopSellConfig" >
        update W_ACC_ST.W_OP_PRM_TVM_STOPSELL_CONFIG set record_flag=#{record_flag_old}
                    where   record_flag=#{record_flag_new}                                               
    </update>
    
    <!--草稿参数复制为当前或未来参数 -->
     <insert id="submitFromDraftToCurOrFur" parameterType="TvmStopSellConfig" >
        insert into W_ACC_ST.W_OP_PRM_TVM_STOPSELL_CONFIG 
              (flow_id,record_flag,version_no,timeTable_id,begin_date,end_date,param_type_id)
        select w_acc_st.W_SEQ_W_OP_PRM_TVM_STOPSELL_CF.nextval,#{record_flag_new},#{version_no_new},timeTable_id,begin_date,end_date,param_type_id 
        from W_ACC_ST.W_OP_PRM_TVM_STOPSELL_CONFIG 
        where record_flag=#{record_flag} and version_no=#{version_no}                                       
    </insert>
    
    <!--草稿参数删除 -->
     <delete id="deleteTvmStopSellConfigsForClone">
            delete from W_ACC_ST.W_OP_PRM_TVM_STOPSELL_CONFIG where  record_flag='3' and version_no='0000000000'                                                      
    </delete>
    
    <!--当前参数或未来参数克隆为草稿参数 -->
    <insert id="cloneFromCurOrFurToDraft" parameterType="TvmStopSellConfig" >
        insert into W_ACC_ST.W_OP_PRM_TVM_STOPSELL_CONFIG 
                    (flow_id,record_flag,version_no,timeTable_id,begin_date,end_date,param_type_id)
         select     w_acc_st.W_SEQ_W_OP_PRM_TVM_STOPSELL_CF.nextval,'3','0000000000',timeTable_id,begin_date,end_date,param_type_id 
         from       W_ACC_ST.W_OP_PRM_TVM_STOPSELL_CONFIG 
         where      record_flag=#{record_flag} and version_no=#{version_no}                                        
    </insert>
</mapper>
